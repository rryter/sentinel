@if (!results) {
  <div class="flex flex-col gap-4 md:flex-row">
    <div class="bg-white shadow rounded-lg p-6 flex-1">
      <hlm-skeleton class="w-12 h-4 mb-2" />
      <hlm-skeleton class="w-24 h-8" />
    </div>
    <div class="bg-white shadow rounded-lg p-6 flex-1">
      <hlm-skeleton class="w-12 h-4 mb-2" />
      <hlm-skeleton class="w-24 h-8" />
    </div>
    <div class="bg-white shadow rounded-lg p-6 flex-1">
      <hlm-skeleton class="w-12 h-4 mb-2" />
      <hlm-skeleton class="w-24 h-8" />
    </div>
    <div class="bg-white shadow rounded-lg p-6 flex-1">
      <hlm-skeleton class="w-12 h-4 mb-2" />
      <hlm-skeleton class="w-24 h-8" />
    </div>
  </div>
} @else {
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Project Card -->
    <app-info-tile
      title="Project"
      [value]="results.project?.name || 'N/A'"
      iconName="project"
      detail1Icon="files"
      [detail1Label]="results.total_files + ' files'"
      detail2Icon="id"
      [detail2Label]="'ID: ' + (results.project?.id || 'N/A')"
    ></app-info-tile>

    <!-- Status Card -->
    <app-info-tile
      title="Status"
      [value]="results.status"
      iconName="status"
      [iconClass]="
        results.status === 'completed' ? 'text-green-500' : 'text-yellow-500'
      "
      detail1Icon="files"
      [detail1Label]="'Scan #' + results.id"
      detail2Icon="timestamp"
      [detail2Label]="
        (results.created_at | date: 'MMM d, yyyy, h:mm a') || 'N/A'
      "
    ></app-info-tile>

    <!-- Duration Card -->
    <app-info-tile
      title="Duration"
      [value]="results.duration ? results.duration + ' ms' : 'N/A'"
      iconName="duration"
      detail1Icon="clock"
      [detail1Label]="
        (formatNumber(results.files_per_second_wall_time) || 0) + ' files/s'
      "
      detail2Icon="cores"
      [detail2Label]="(results.parallel_cores_used || 1) + ' cores'"
    ></app-info-tile>

    <!-- Matches Card -->
    <app-info-tile
      title="Matches"
      [value]="results.total_matches"
      iconName="matches"
      detail1Icon="files"
      [detail1Label]="'in ' + results.total_files + ' files'"
      detail2Icon="rules"
      [detail2Label]="'from ' + results.rules_matched + ' rules'"
    ></app-info-tile>
  </div>

  <!-- Rules Breakdown Section -->
  <div class="mt-8">
    <h3 class="text-lg font-medium text-gray-900 mb-4">Matches by Rule</h3>
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="max-h-80 overflow-y-auto">
        @for (rule of getObjectEntries(results || {}); track $index) {
          <div
            class="flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50"
          >
            <div>
              <p class="font-medium text-gray-800">{{ rule[0] }}</p>
              <p class="text-xs text-gray-500">Pattern match</p>
            </div>
            <div>
              <span
                class="px-3 py-1 text-sm font-medium rounded-full"
                [ngClass]="{
                  'bg-red-100 text-red-800': rule[1] > 100,
                  'bg-yellow-100 text-yellow-800':
                    rule[1] > 20 && rule[1] <= 100,
                  'bg-green-100 text-green-800': rule[1] <= 20,
                }"
              >
                {{ rule[1] }} matches
              </span>
            </div>
          </div>
        } @empty {
          <div class="p-6 text-center text-gray-500">No rule matches found</div>
        }
      </div>
    </div>
  </div>
}
